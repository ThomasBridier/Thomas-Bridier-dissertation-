---
title: "DATA ANALYSIS DISS"
output: html_document
date: "2023-11-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. DATA IMPORTATION

## 1.1. import libraries

```{r}
library(dplyr)
library(ggplot2)
library(esquisse)
library(readxl)
library(tidyr)
library(car)
library(lsmeans)
library(openxlsx)
library(corrplot)
library(stats)

citation()
```

## 1.2 Import files

```{r}
df1 <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "record_sheet")
df1 <- df1[df1$site_status != "Not Available" & df1$ISO3 != "SWE", ]

```

# 2. CONTRIBUTION SCORES + EFFECTIVENESS

## 2.1 Pivot table

```{r message=FALSE, warning=FALSE}
# Assuming df1 is your data frame
columns_to_exclude <- c("7AC", "10", "11", "12", "13", "14", "15", "16", "18", "27", "28", "29", "30", "31AC")
df1.1 <- df1[, setdiff(names(df1), columns_to_exclude)]
columns_to_convert <- 34:56
# Convert the specified columns to numeric
df1.2 <- df1.1 %>%
  mutate_at(vars(columns_to_convert), as.numeric)

df2 <- pivot_longer(df1.2, cols = 34:55, names_to = "question", values_to = "score")
df2 <- df2 %>%
  mutate(category = case_when(
    question %in% c(1, 5, 6, 7, 34) ~ "A",
    question %in% c(2, 3, 4) ~ "B",
    question %in% c(8, 19, 20, 21, 22, 23, 24, 32, 33) ~ "C",
    question %in% c(9, 17, 25, 26, 31) ~ "D",
    TRUE ~ NA_character_  # Handle other cases if any
  ))
```

## 2.2 contribution score

### 2.2.1 creation of the contribution score

```{r}
df2 <- df2 %>%
  mutate(contribution = (score - average_score)*100) %>%
  ungroup()
```

### 2.2.2 data analysis - Contribution \~ question

```{r}
mod1<-aov(contribution~question,data=df2)
summary(mod1)
posthoc <- lsmeans(mod1, "question", adjust = "tukey")
# View post hoc comparisons
posthoc
plot(posthoc)
```

### 2.2.3 plot the contribution

```{r}
df2$question <- as.factor(df2$question)
ggplot(df2) +
  aes(x = question, y = contribution) +
  geom_boxplot(fill = "#CCCDCD") +theme_bw(15)+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())+labs(x = "question", y = "contribution (%)")
```

```{r}
# Example data frame
df2 <- df2[!(df2$question %in% c("28", "29", "30")), ]
# Convert question to factor with levels sorted numerically
df2$question <- factor(df2$question, levels = unique(df2$question))
ggplot(df2) +
  aes(x = question, y = contribution) +
  geom_boxplot(fill = "#CCCDCD") +
  theme_bw(15) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  labs(x = "Question ID", y = "Contribution (%)")

```

```{r}
df2$question <- factor(df2$question, levels = unique(df2$question[order(df2$category)]))

# Plotting with ggplot
ggplot(df2) +
  aes(x = question, y = contribution, fill = category) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +theme_bw(15) +
 theme(panel.grid = element_blank(),axis.title = element_text(face = "bold")) +
  labs(x = "Question ID", y = "Contribution (%)")

```

## 2.3 overall score

### 2.3.1 graphs

```{r}
library(ggplot2)
ggplot(df1.2) +
  aes(x = ratio) +
  geom_histogram(bins = 30L, fill = "#CCCDCD", color = "black", size = 0.5) +
  geom_vline(xintercept = 37.67404, color = "black", linetype = "dashed", size = 1) +  # Add vertical line
  labs(x = "Effectiveness score (%)", y = "Number of Assessments") +
  theme_bw(base_size = 15) +theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))  # Remove grid



```

### 2.3.2 : quartile calculation in %

```{r}
# Assuming "df2" is your data frame
mean<-mean(df1.2$ratio)
mean
percentage_below_33 <- mean(df1.2$ratio < 33)*100
percentage_below_67 <- mean(df1.2$ratio > 67) * 100
percentage_between <-100-percentage_below_33-percentage_below_67
cat("Percentage of the total dataset above 67%:", percentage_below_67, "%\n")
cat("Percentage of the total dataset below 33%:", percentage_below_33, "%\n")
cat("Percentage of the total dataset between 33% and 67%:", percentage_between, "%\n")


```

### 2.3.3 : quartile calculation in nb

```{r}
mean_value <- mean(df1.2$ratio)
percentage_below_33 <- sum(df1.2$ratio < 33)
percentage_below_67 <- sum(df1.2$ratio > 67)
percentage_between <- nrow(df1.2) - percentage_below_33 - percentage_below_67
cat("Number of values above 67%:", percentage_below_67, "\n")
cat("Number of values below 33%:", percentage_below_33, "\n")
cat("Number of values between 33% and 67%:", percentage_between, "\n")
```

### 2.3.4 : score per question -

```{r}
# Assuming you have the dplyr package installed, if not, install it using install.packages("dplyr")
library(dplyr)

# Assuming df2 is your dataframe
df2$score <- as.numeric(df2$score)
df2$question <- as.factor(df2$question)

# Check for any NA values in the score column and remove them if necessary
df2 <- df2[!is.na(df2$score), ]

# Check if there are any levels in the "question" column with insufficient data
question_counts <- table(df2$question)
questions_to_remove <- names(question_counts[question_counts < 2])
df2 <- df2[!df2$question %in% questions_to_remove, ]

# Now, calculate the mean and standard deviation and add a column with the number of rows
result_table <- df2 %>%
  group_by(question) %>%
  summarize(mean_score = mean(score, na.rm = TRUE),
            sd_score = sd(score, na.rm = TRUE),
            num_rows = n())

# Print the resulting table
View(result_table)
write.xlsx(result_table, "output_table.xlsx", rowNames = FALSE)

```

# 3. COMPARISION PA TO PA

## 3.1 Ratio - Size

### 3.1.1 data analysis

```{r}
lm1<-lm(log(ratio)~log(area_ha),data=df1.2)
summary(lm1)

```

**assumption validated ?**

```{r}
plot(lm1)
```

### 3.1.2 plot the relationship

```{r}
ggplot(df1.2) +
  aes(x =log(ratio) , y = log(area_ha)) +
  geom_point(shape = "circle", size = 1.4, colour = "black") +  
  geom_smooth(method = "lm", se = TRUE, color = "grey") +  # Add a linear trendline in blue
  theme_bw(15) +  # Apply a black and white theme
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = " log Protected area size (ha) ", y = "log effectiveness score (%)")
```

## 3.2 Ratio - Fishing

### 3.2.1 **2021 data**

#### 3.2.1.1 2021: data analysis

```{r}
lm2<-lm(log(ratio)~total_hours_fished_ha,data=df1.2)
summary(lm2)

```

```{r}
plot(lm2)

```

#### 3.2.1.2 2021 graphs

```{r}
ggplot(df1.2) +
  aes(x = total_hours_fished_ha, y = log(ratio)) +
  geom_point(shape = "circle", size = 2, colour = "black") +  # Change point size to 15 and color to black
  geom_smooth(method = "lm", se = TRUE, color = "grey") +  # Add a linear trendline in blue
  theme_bw(15) +  # Apply a black and white theme
  theme(panel.grid = element_blank())+labs(x = "Total hours fished / ha", y = "Percentage of Effectiveness (log scale)")
```

### 3.2.2 EU data **no change**

**data anal -**

```{r}
fish_EU <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "Fishing activity (2018-2021)")

lm3<-lm(log(`score PA`)~`Total fishing / ha`,data=fish_EU)
summary(lm3)
plot(lm3)
```

**graphs**

### 3.2.3 EU data **(below 5\* grid cell resolution in size)**

**data anal**

```{r}
# Assuming fish_EU is your data frame
fish_EU1 <- fish_EU[fish_EU$AREA_HA >= 7500, ]
lm3<-lm(`score PA`~`Total fishing / ha`,data=fish_EU1)
summary(lm3)
plot(lm3)
```

**graphs - outlier out**

```{r}
ggplot(fish_EU1) +
  aes(x = `score PA`, y = `Total fishing / ha`) +geom_point(shape = "circle", size = 2, colour = "black") +  # Change point size to 15 and color to black
  geom_smooth(method = "lm", se = TRUE, color = "grey") +  # Add a linear trendline in blue
  theme_bw(15) +  # Apply a black and white theme
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = "effectiveness score (%)", y = "Total fishing effort / ha")+ylim(-0.01,0.125)
```

**Per gear type**

```{r}
# Assuming fish_EU1 is your dataframe

fish_EU1$OT_fishing_per_ha <- fish_EU1$OT_fishing / fish_EU1$AREA_HA
fish_EU1$Beam_fishing_per_ha <- fish_EU1$Beam_fishing / fish_EU1$AREA_HA
fish_EU1$Seine_fishing_per_ha <- fish_EU1$Seine_fishing / fish_EU1$AREA_HA
fish_EU1$Dredge_fishing_per_ha <- fish_EU1$Dredge_fishing / fish_EU1$AREA_HA

```

```{r}
lm3.1<-lm(`score PA`~OT_fishing_per_ha,data=fish_EU1)
lm3.2<-lm(`score PA`~Beam_fishing_per_ha,data=fish_EU1)
lm3.3<-lm(`score PA`~Seine_fishing_per_ha,data=fish_EU1)
lm3.4<-lm(`score PA`~Dredge_fishing_per_ha,data=fish_EU1)
summary(lm3.1)
summary(lm3.2)
summary(lm3.3)
summary(lm3.4)
```

**Graphs -**

```{r}
# Graph for OT_fishing_per_ha
ggplot(fish_EU1) +
  aes(x = `score PA`, y = OT_fishing_per_ha) +
  geom_point(shape = "circle", size = 2, colour = "black") +
  geom_smooth(method = "lm", se = TRUE, color = "grey") +
  theme_bw(15) +
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold")) +
  labs(x = "effectiveness score (%)", y = "Otter fishing effort / ha")+ylim(-0.01, 0.125)

# Graph for Beam_fishing_per_ha
ggplot(fish_EU1) +
  aes(x = `score PA`, y = Beam_fishing_per_ha) +
  geom_point(shape = "circle", size = 2, colour = "black") +
  geom_smooth(method = "lm", se = TRUE, color = "grey") +
  theme_bw(15) +
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold")) +
  labs(x = "effectiveness score (%)", y = "Beam fishing effort / ha")+ylim(-0.01,0.125)

```

### 3.2.4 EU data **(below 5\* grid cell resolution in size; designated \<2018)**

**changes -**

```{r}
fish_EU2 <- fish_EU1[fish_EU1$Column1 <= 2018, ]
lm4<-lm(`score PA`~`Total fishing / ha`,data=fish_EU2)
summary(lm4)

ggplot(fish_EU2) +
  aes(x = `score PA`, y = `Total fishing / ha`) +
  geom_point(shape = "circle", size = 1.5, colour = "#112446") + theme_bw(15) +  # Apply a black and white theme
  theme(panel.grid = element_blank())+labs(x = "effectiveness score", y = "fishing effort / ha")
```

### 3.2.5 fishing restrictions x Score

```{r}
df3.2.5 <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "JNCC_data ")
df3.2.5 <- df3.2.5[df3.2.5$`Area (ha)` >= 7500, ]
df3.2.5 <- df3.2.5[df3.2.5$Site_name != "Dolphin Head", ]
View(df3.2.5)


ggplot(df3.2.5) +
  aes(x = `fishing_restriction`, y = score) +
  geom_boxplot() + labs(fill = "Fishing restriction")+ # Neutral grey color for the box
  theme_bw(15) +  # Black and white theme
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold")) +
  # Change the X axis title
  xlab("Bottom Fishing Restriction") +ylab("effectiveness score (%)")+
  # Set Y axis limits
  ylim(0, 100)
```

#### analysis -

```{r}
mod3.2.5<-aov(score~`fishing_restriction`,data=df3.2.5)
summary(mod3.2.5)
posthoc <- TukeyHSD(mod3.2.5)

# Print the results
print(posthoc)

```

### 3.2.6 fishing restrictions x Total fishing

```{r}
ggplot(df3.2.5) +
  aes(x = fishing_restriction, y = `Total_fished _ha`) +
  geom_boxplot(fill = "grey80", color = "black") +  # Neutral grey color for the box
  theme_bw(15) +  # Black and white theme
  theme(panel.grid = element_blank(),axis.title = element_text(face = "bold")) +
  # Change the X axis title
  xlab("Bottom Fishing Restriction") +ylab("Total fishing effort / ha")
  # Set Y axis limits
```

**Analysis**

```{r}
mod3.2.6<-aov(`Total_fished _ha`~fishing_restriction,data=df3.2.5)
summary(mod3.2.6)

mod3.2.6<-aov(BT_HA~fishing_restriction,data=df3.2.5)
summary(mod3.2.6)
```

### 3.2.7 **for BT and OT**

**data anal**

```{r}
mod3.2.6<-aov(BT_HA~fishing_restriction,data=df3.2.5)
summary(mod3.2.6)
mod3.2.6<-aov(OT_HA~fishing_restriction,data=df3.2.5)
summary(mod3.2.6)
```

**graph**

```{r}
df3.2.7 <- pivot_longer(df3.2.5, cols = 6:7, names_to = "geartype", values_to = "fishing_effort")
df3.2.7 <- df3.2.7 %>%
  mutate(geartype = ifelse(geartype == "OT_HA", "Otter Trawl", 
                           ifelse(geartype == "BT_HA", "Beam Trawl", geartype)))


ggplot(df3.2.7) +
  aes(
    x = geartype,
    y = fishing_effort,
    fill = fishing_restriction
  ) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +
  labs(fill = "Fishing restriction") +  # Change legend title
  theme_bw(12) +  # Black and white theme
  theme(panel.grid = element_blank(),
        axis.title = element_text(face = "bold"),
        legend.position = "top") +  # Change legend position to top
  # Change the X axis title
  xlab("gear type") +
  ylab(" Fishing effort / ha")

```

## 3.3 Ratio - Year established -

### 3.3.1 Data analysis

```{r}
lm3<-lm(ratio~STATUS_YR,data=df1.2)
summary(lm3)
```

### 3.3.2 assumptions -

```{r}
plot(lm3)
```

### 3.3.3 plot relationship

```{r}
ggplot(df1.2) +aes(x = STATUS_YR, y = ratio) + geom_point(shape = "circle", size = 2, colour = "black") + geom_smooth(method = "lm", se = TRUE, color = "grey") + theme_bw(15) + theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = "Year The Protected Area was established", y = "effectiveness score (%)")
```

## 3.4 Ratio - site status

### 3.4.1 data analysis -

```{r}
mod2 <- aov(log(ratio) ~ site_status, data = df1.2)
summary(mod2)
```

### 3.4.2 assumptions -

```{r}
plot(mod2)
```

### 3.4.3 Graphs

```{r}
ggplot(df1.2) +
  aes(x = site_status, y = ratio) +
  geom_boxplot(fill = "#112446") +  theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

## 3.5 OSPAR management category

### 3.5.1 pivot for the OSPAR

```{r}
df3 <- pivot_longer(df1.2, cols = 67:70, names_to = "OSPAR Question", values_to = "answer OSPAR")
View(df3)
```

### 3.5.2 OSPAR graph

OSP_A

```{r}
ggplot(df1.2) +
  aes(x = OSP_A) +
  geom_bar(fill = "#112446") + theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

**data analysis -**

```{r}
mod5 <- aov(log(ratio) ~ OSP_A, data = df1.2)
summary(mod5)
```

```{r}
esquisser(df1.2)
```

OSP_B

```{r}
ggplot(df1.2) +
  aes(x = OSP_B) +
  geom_bar(fill = "#112446") + theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

OSP_C

```{r}
ggplot(df1.2) +
  aes(x = OSP_C) +
  geom_bar(fill = "#112446") + theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

OSP_D

```{r}
ggplot(df1.2) +
  aes(x = OSP_D) +
  geom_bar(fill = "#112446") + theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

### 3.6.1 Distance from the shore

```{r}
df1.2 <- df1.2 %>%
  mutate(NEAR_DIST_M = as.numeric(NEAR_DIST_M)) %>%
  filter(!is.na(NEAR_DIST_M))
lm7<-lm(log(ratio)~NEAR_DIST_M,data=df1.2)
summary(lm7)
```

## 4. CATEGORIES OF METT

## 4.1 pivot table

### 4.1.1 creation

```{r}
df4 <- pivot_longer(df1.2, cols =60:63 , names_to = "Categories", values_to = "Ratio_cat")

```

### 4.1.2 data analysis

```{r}
lm4<-aov(Ratio_cat~Categories,data=df4)
summary(lm4)
```

```{r}
posthoc <- TukeyHSD(lm4)

# Print the results
print(posthoc)
plot(posthoc)
```

### 4.1.3 plot per Categories

```{r}
df4 <- df4 %>%
  mutate(Categories = gsub("ratio_A", "A", Categories)) %>%
  mutate(Categories = gsub("ratio_B", "B", Categories)) %>%
  mutate(Categories = gsub("ratio_C", "C", Categories)) %>%
  mutate(Categories = gsub("ratio_D", "D", Categories))
```

barplot

```{r}
ggplot(df4, aes(x = Categories, y = Ratio_cat)) +
  geom_bar(stat = "summary", fun = "mean", fill = "black", alpha = 0.7) +  # Set fill to black
  labs(title = "Average Ratio by Categories",
       x = "Categories",
       y = "Average Ratio (%)") +
  theme_bw() +  # Use a black and white theme
  theme(panel.grid.major = element_blank(),    # Remove major grid lines
        panel.grid.minor = element_blank(),    # Remove minor grid lines
        axis.line = element_line(color = "black"),  # Set axis line color to black
        panel.border = element_blank())  # Remove panel border
```

**boxplot -**

```{r}

ggplot(df4) +
  aes(x = Categories, y = Ratio_cat,fill = Categories) +
  geom_boxplot() + theme_bw(15)+theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = "Categories of management", y = "Effectiveness score (%)")
```

## 4.2 Spider plot

### 4.2.1 spider CATEGORIES

```{r}
df_spider <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "record_sheet")
columns_to_convert <- 34:69
# Convert the specified columns to numeric
df_spider <- df_spider %>%
  mutate_at(vars(columns_to_convert), as.numeric)
```

```{r}
df_spider <- df4[df4$NAME == "The Canyons" & df4$Categories %in% c("ratio_A", "ratio_B", "ratio_C", "ratio_D"), ]
  Ratio_cat = rep(c(100, 0, 0, 0), times = 4)
# Create a spider plot
ggplot(df_spider, aes(x = Categories, y = Ratio_cat, group = 1)) +
  geom_polygon(fill = "skyblue", color = "darkblue", size = 1, alpha = 0.7) +  # Filled polygon
  geom_line(color = "darkblue", size = 1, alpha = 0.7) +  # Add lines
  geom_point(color = "darkblue", size = 3) +
  coord_polar(start = 0) +
  theme_minimal() +
  labs(title = "Filled Polygon Spider Plot for Scanner Pockmark",
       subtitle = "Categories: ratio_A, ratio_B, ratio_C, ratio_D",
       caption = "Source: Your Data Source",
       fill = "Categories") +
  theme(legend.position = "none") 
```

```{r}
library(fmsb)
df5 <- df1.2[df1.2$NAME == "Hatton Bank", ]
df5 <- df5[, c("ratio_A", "ratio_B", "ratio_C", "ratio_D")]
df5 <- rbind(rep(100,4) , rep(0,4) , df5)
radarchart(df5)
```

### 4.2.2 spider category C :

```{r}
# Assuming df1.2 is your original data frame

# Select rows from df1.2 with NAME equal to "The Canyons"
df5.2 <- df_spider[df_spider$NAME == "Hatton Bank", ]
# Select specific columns from df5.2
df5.2 <- df5.2[, c("8", "19", "20", "21", "22", "23", "24", "32", "33")]
# Add a new row to df5.2 with the values corresponding to "Bratten "
new_row <- df_spider[df_spider$NAME == "Bratten", c("8", "19", "20", "21", "22", "23", "24", "32", "33")]
df5.2 <- rbind(rep(3, 9), rep(0, 9), df5.2, new_row)
```

**change the col names**

```{r}
colnames(df5.2) <- c(
  "Regular Work Plan",
  "Research",
  "Monitoring and Evaluation",
  "Resource Management",
  "Climate Change",
  "Carbon Capture",
  "Ecosystem Services",
  "Livelihood Benefits",
  "Threats"
)
View(df5.2)
```

**plots**

```{r fig.height=6, fig.width=7}
library(fmsb)

# Assuming df5.2 has two rows represented
# Custom colors with transparency for each row
new_colors <- c(rgb(1, 0.5, 0.5, 0.5), rgb(0.5, 0.5, 1, 0.5))
  # Adjust the alpha value (0.5) for transparency

# Custom names for the legend
legend_names <- c("The Canyons", "Nordvästra Skånes havsområde")

# Create the radar chart
radarchart(
  df5.2,
  axistype = 1,
  pcol = new_colors,
  pfcol = new_colors,  # Use the custom colors with transparency for fill
  plwd = 4,
  cglcol = "grey",
  cglty = 1,
  axislabcol = "black",
  cglwd = 0.8,
  vlcex = 0.8)

```

### 4.2.3 Category A -

```{r}
df5.3 <- df1.2[df1.2$NAME == "Hatton Bank", ]

# Select specific columns from df5.2
df5.3 <- df5.3[, c("1", "5", "6", "7", "34")]

# Add a new row to df5.2 with the values corresponding to "Nordvästra Skånes havsområde"
new_row <- df_spider[df_spider$NAME == "Bratten", c("1", "5", "6", "7", "34")]
df5.3 <- rbind(rep(3, 5), rep(0, 5), df5.3, new_row)
```

**change col name**

```{r}
colnames(df5.3) <- c("legal status","protected area design","PA boundary demarcation","management planning","connectivity")
```

**plot -**

```{r fig.height=6, fig.width=7}
library(fmsb)

# Assuming df5.2 has two rows represented
# Custom colors with transparency for each row
colors <- c(rgb(1, 0.5, 0.5, 0.5), rgb(0.5, 0.5, 1, 0.5))
  # Adjust the alpha value (0.5) for transparency

# Create the radar chart
radarchart(df5.3, axistype = 1, pcol = colors, pfcol = colors, plwd = 4, cglcol = "grey", cglty = 1, axislabcol = "black", cglwd = 0.8, vlcex = 1, cglcex = 1,axlabcex = 1)

```

### 4.2.3 Category B -

```{r}
df5.4 <- df_spider[df_spider$NAME == "Hatton Bank", ]

# Select specific columns from df5.2
df5.4 <- df5.4[, c("2", "3", "4")]

# Add a new row to df5.2 with the values corresponding to "Nordvästra Skånes havsområde"
new_row <- df_spider[df_spider$NAME == "Bratten", c("2", "3", "4")]
df5.4 <- rbind(rep(3, 3), rep(0, 3), df5.4, new_row)
```

```{r}
colnames(df5.4) <- c("protected area objectives","PA regulation / controls","Planning for adjacent land / sea use")
```

```{r fig.height=6, fig.width=7}
# Assuming df5.2 has two rows represented
# Custom colors with transparency for each row
colors <- c(rgb(1, 0.5, 0.5, 0.5), rgb(0.5, 0.5, 1, 0.5))

# Create the radar chart
radarchart(
  df5.4,
  axistype = 1,
  pcol = colors,
  pfcol = colors,  # Use the custom colors with transparency for fill
  plwd = 4,
  cglcol = "grey",
   plcol = "black",
  cglty = 2,
  axislabcol = "black",
  cglwd = 0.8,
  vlcex = 1
)
```

### 4.2.4 Category D -

```{r}
df5.5 <- df_spider[df_spider$NAME == "Hatton Bank", ]

# Select specific columns from df5.2
df5.5 <- df5.5[, c("9", "17", "25","26","31")]

# Add a new row to df5.2 with the values corresponding to "Nordvästra Skånes havsområde"
new_row <- df_spider[df_spider$NAME == "Hatton Bank", c("9", "17", "25","26","31")]
df5.5 <- rbind(rep(3, 5), rep(0, 5), df5.5, new_row)
View(df5.5)
```

```{r}
colnames(df5.5) <- c("resource inventory","protection systems","education and awareness","state and commercial neighbours","local communities")

```

```{r fig.height=6, fig.width=7}
  # Adjust the alpha value (0.5) for transparency

# Create the radar chart
radarchart(
  df5.5,
  axistype = 1,
  pcol = colors,
  pfcol = colors,  # Use the custom colors with transparency for fill
  plwd = 4,
  cglcol = "grey",
  cglty = 1,
  axislabcol = "black",
  cglwd = 0.8,
  vlcex = 0.8
)

```

## 5. COMPARISON SWE VS UK

```{r}
df7 <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "record_sheet")
df7$site_status <- as.factor(df7$site_status)
df7 <- df7[df7$site_status != 'Not Available',]
df7<-df7[, -c(41, 44:50, 52,53,54, 61, 66)]
columns_to_convert <- 34:56
# Convert the specified columns to numeric
df7<- df7 %>%
  mutate_at(vars(columns_to_convert), as.numeric)
df7.2 <- pivot_longer(df7, cols = 34:56, names_to = "question", values_to = "score")
df7.3 <- pivot_longer(df7, cols =61:64 , names_to = "Categories", values_to = "Ratio_cat")

```

### 5.1 Ratios general + cat

#### 5.1.1 Ratio general

**graphs**

```{r}
ggplot(df7) +
  aes(x = ISO3, y = ratio, fill = ISO3) +
  geom_boxplot() +
  scale_fill_hue(direction = 1) +theme_bw(15)+theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = "Countries", y = " Effectiveness score (%)")+ scale_fill_manual(
    values = c(GBR = "#FFBFBF",
    SWE = "#BFBFFF"))
```

**data anal**

```{r}
mod7<-aov(ratio ~ ISO3, data = df7)
summary(mod7)
```

```{r}
plot(mod7)
```

#### 5.1.2 PER CATEGORY

**graphs**

```{r}
df7.3<- df7.3 %>%
  mutate(Categories = gsub("ratio_A", "A", Categories)) %>%
  mutate(Categories = gsub("ratio_B", "B", Categories)) %>%
  mutate(Categories = gsub("ratio_C", "C", Categories)) %>%
  mutate(Categories = gsub("ratio_D", "D", Categories))
ggplot(df7.3) +
  aes(x = Categories, y = Ratio_cat, fill = ISO3) +
  geom_boxplot() + scale_fill_manual(
    values = c(GBR = "#FFBFBF",
    SWE = "#BFBFFF"))+
  theme_bw(15)+theme(panel.grid = element_blank(),axis.title = element_text(face = "bold"))+labs(x = "Management category", y = "Effectiveness score (%)")

```

```{r}
ggplot(df7.3) +
  aes(x = Categories, y = Ratio_cat, fill = ISO3) +
  geom_boxplot() +
  scale_fill_manual(
    values = c(GBR = "#BDBDBD",
    SWE = "#7D757A")
  ) +
  theme_minimal()
```

**data analysis**

```{r}
mod3<-aov(Ratio_cat ~ ISO3*Categories, data = df4)
summary(mod3)
```

**post hoc test -**

```{r}
posthoc <- TukeyHSD(mod3)
# Print the results
print(posthoc)
plot(posthoc)
```

# 6 SCORE V PA CHARACTERISTICS

```{r}
df6 <- read_excel("C:/Users/thomb/OneDrive - University of Edinburgh/4th year/dissertation project/bibliography/dataset/Diss project/excel file/actual_dataset.xlsx", 
    sheet = "JNCC_Features_protected")
```

## 6.1 Feature type

### figure

```{r}
library(ggplot2)

ggplot(df6) +
  aes(x = Feature_type_broad, y = Ratio) +
  geom_boxplot(fill = "#CCCDCD") +  # Remove fill color
  theme_bw(15) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ labs(x = "Feature type (broad)", y = "Percentage of Effectiveness") 

```

### data analysis

```{r}
mod6.1 <- aov(log(Ratio) ~Feature_type_broad, data = df6) 
summary(mod6.1)
```

```{r}
plot(mod6.1)
```

**post hoc**

```{r}
posthoc <- TukeyHSD(mod6.1)

# Print the results
print(posthoc)
plot(posthoc)
```

## 6.2 feature type (specific)

### figure

```{r}
ggplot(df6) +
  aes(x = Feature_type_specific, y = Ratio) + geom_boxplot(fill = "#112446") +  theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

### data analysis

```{r}
mod6.2 <- aov(log(Ratio) ~Feature_type_specific, data = df6) 
summary(mod6.2)
```

```{r}
plot(mod6.2)
```

```{r}
posthoc <- TukeyHSD(mod6.2)

# Print the results
print(posthoc)
plot(posthoc)
```

## 6.3 CP2 region

### 6.3.1 V1

### figure

```{r}
ggplot(df6) +
  aes(x = CP2_Region, y = Ratio) + geom_boxplot(fill =  "#CCCDCD") +  theme_bw()+theme(axis.text.x = element_text(angle = 30, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

### data analysis

```{r}
mod6.3 <- aov(log(Ratio) ~CP2_Region, data = df6) 
summary(mod6.3)
```

```{r}
plot(mod6.3)
```

**tuckey**

```{r}
posthoc <- TukeyHSD(mod6.3)

# Print the results
print(posthoc)
plot(posthoc)
```

### 6.3.2 V2 -

```{r}
mod6.3 <- aov(log(ratio) ~CP2_region, data = df1.2) 
summary(mod6.3)
```

```{r}
ggplot(df1.2) +
  aes(x = CP2_region, y = ratio) + geom_boxplot(fill =  "#CCCDCD") +  theme_bw()+theme(axis.text.x = element_text(angle = 30, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

## 6.4 Country

### figure

```{r}
ggplot(df6) +
  aes(x = `Country`, y = Ratio) + geom_boxplot(fill = "#112446") +  theme_bw()+theme(axis.text.x = element_text(angle = 45, hjust = 1))+theme(panel.grid.major = element_blank(),
           panel.grid.minor = element_blank())
```

### data analysis

# 7. relation between the questions -

## 7.1 corrplot -

```{r}
# Select columns 34 to 55 from the dataset
selected_columns <- df1.2[, 34:55]
M = cor(selected_columns)
corrplot(M,na.label=" ") # by default, method = 'circle'

```
